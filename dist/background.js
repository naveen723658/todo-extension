chrome.runtime.onMessage.addListener(((o,e,s)=>{if("SYNC_TODOS"===o.message)console.log("Background Script: Received SYNC_TODOS request with data:",o.todos),function(o,e=!0){chrome.storage.sync?chrome.storage.sync.get("todos",(s=>{let r=s.todos||[];const t=o.map((o=>"object"==typeof o&&o.text?o.text:String(o)));r=[...r,...t],console.log("Background Script: Attempting to save todos as strings:",r),chrome.storage.sync.set({todos:r},(()=>{chrome.runtime.lastError?console.error("Background Script: Error setting todos in chrome.storage.sync:",chrome.runtime.lastError):(console.log("Background Script: Todos successfully saved in storage:",r),e&&chrome.tabs.query({},(o=>{o.forEach((o=>{o.id&&(chrome.tabs.sendMessage(o.id,{message:"SYNC_TODOS",todos:r}),console.log("Background Script: Broadcasted todos to tab:",o.id))}))})))}))})):console.error("Background Script: chrome.storage.sync is undefined.")}(o.todos,!1),s({status:"success"});else{if("GET_TODOS"===o.message)return chrome.storage.sync.get("todos",(o=>{console.log("Background Script: Retrieved todos from storage:",o.todos),s({todos:o.todos||[]})})),!0;"DELETE_TODO"===o.message&&(r=o.todoText,chrome.storage.sync?chrome.storage.sync.get("todos",(o=>{let e=o.todos||[];e=e.filter((o=>o!==r)),console.log(e),chrome.storage.sync.set({todos:e},(()=>{chrome.runtime.lastError?console.error("Error deleting todo in chrome.storage.sync:",chrome.runtime.lastError):chrome.tabs.query({},(o=>{o.forEach((o=>{o.id&&chrome.tabs.sendMessage(o.id,{message:"SYNC_TODOS",todos:e})}))}))}))})):console.error("Background Script: chrome.storage.sync is undefined."),s({status:"success"}))}var r}));